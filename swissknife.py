from glitter import *

"""
This function prints the main menu to the user
"""


def printMenu():
    print("Welcome to the glitter swissknife!")
    print("Please choose from the options below the way you want to pentest product:")
    print("\t[0] - Exit")
    print("\t[1] - find vulnerabilities in the website")
    print("\t[2] - find vulnerabilities in the app\n")


"""
This function gets what the user wants to do
@return what the user has chosen to do in the swissknife
"""


def getChoice():
    printMenu()
    choice = input(">> ")
    while choice != "1" and choice != "2" and choice != "0":
        print("Invalid choice , try again")
        choice = input(">> ")

    return choice


"""
This function asks the user which vulnerabilitie they want to see, and validates the input
@return a number from 0-9, which specifies which vulnerabilitie they want to invistiagte
"""


def getAppMenuChoice():
    print("Please choose what one of the options below:")
    print("\t[0] - EXIT")
    print("\t[1] - Add likes to one of your glits")
    print("\t[2] - Add a like to one of your glits with different username")
    print("\t[3] - Post a glit with a different color")
    print("\t[4] - Post a glit with a different avatar")
    print("\t[5] - Post a glit with a different date")
    print("\t[6] - Post a glit with a different font color")
    print("\t[7] - Remove other user likes")
    print("\t[8] - Post a comment with a different date")
    print("\t[9] - Post a comment with a different username")

    choice = input(">> ")
    while choice not in [str(i) for i in range(0, 10)]:
        print("Invalid choice , try again")
        choice = input(">> ")

    return choice


"""
This function asks the user which challenge they want to see, and validates the input
@return a number from 0-5, which specifies which challenge they want to see
"""


def getChallengesMenuChoice():
    print("Here are all of the solved challenges, please choose one of them: ")
    print("\t[0] - EXIT")
    print("\t[1] - Login challenge")
    print("\t[2] - Password challenge")
    print("\t[3] - Cookie challenge")
    print("\t[4] - Privacy challenge")
    print("\t[5] - XSRF challenge")

    choice = input(">> ")
    while choice not in [str(i) for i in range(0, 6)]:
        print("Invalid choice , try again")
        choice = input(">> ")

    return choice


"""
This function asks the user which vulnerabilitie they want to see, and validates the input
@return a number from 0-5, which specifies which vulnerabilitie they want to invistigate
"""


def getVulnerabilitiesMenuChoice():
    print("Here are all of the found vulnerabilities, please choose one of them: ")
    print("\t[0] - EXIT")
    print("\t[1] - Add likes to your glit (HTTP approach)")
    print("\t[2] - Ruin a user profile")
    print("\t[3] - Post a glit with a different font color (HTTP approach)")
    print("\t[4] - Add a new friends without them accepting")
    print("\t[5] - Post comment with any date (HTTP approach)")

    choice = input(">> ")
    while choice not in [str(i) for i in range(0, 6)]:
        print("Invalid choice , try again")
        choice = input(">> ")

    return choice


"""
This function handles the challenges section, it asks the user for a challenge and calls the corrosponding function
"""


def handleChallenges():
    server_sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server_sock.connect((SERVER_IP, SERVER_PORT))
    account_data = getUserAndLogin(server_sock)
    if account_data == -1:
        return
    choice = ""

    while choice != "0":
        choice = getChallengesMenuChoice()
        if choice == "1":
            loginChallenge()
        if choice == "2":
            passwordChallenge(server_sock)
        if choice == "3":
            cookieChallenge(server_sock)
        if choice == "4":
            privacyChallenge(server_sock)
        if choice == "5":
            xsrfChallenge(server_sock, account_data)


"""
This function handles the website vulnerabilities section, it asks the user for a Vulnerabilitie and calls the corrosponding function
"""


def handleWebsiteVulnerabilities():
    choice = ""
    username = input("Enter username: ")
    password = input("Enter password: ")
    account_data = loginWebsite(username, password)

    if account_data == -1 or account_data == None:
        return
    while choice != "0":
        choice = getVulnerabilitiesMenuChoice()

        if choice == "1":
            addLikesToGlitWebsite(account_data)

        if choice == "2":
            postGlitWithHugeImage(account_data)

        if choice == "3":
            postGlitDifferentFontColorWebsite(account_data)
        if choice == "4":
            addFriendWithoutAccepting(account_data)
        if choice == "5":
            postCommentDifferentDateWebsite(account_data)


"""
This function handles the website pentesting, it asks the user wether they want to see the challenges or just normal vulnerabilities
"""


def penTestwebsite():

    choice = input(
        "Please enter how would like to pentest the website:\n\t[1] - Challenges\n\t[2] - Normal vulnerabilities\n>> ")
    if choice == "1":
        handleChallenges()
    elif choice == "2":
        handleWebsiteVulnerabilities()
    else:
        print("Invalid choice, going back to main menu...")


"""
This function handles the app pentesting, it asks the user for vulnerabilitie to investigate, and calls the corrosponding function
"""


def penTestapp():
    server_sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server_sock.connect((SERVER_IP, SERVER_PORT))

    print("Cool!\nBefore we will go through all of the vulnerabilities, please login to your account:")
    username = input("Enter username: ")
    password = input("Enter password: ")
    account_data = login(username, password, server_sock)
    if account_data == None:
        print("Error, couldn't login to this account.")
        return
    choice = ""

    while choice != "0":
        choice = getAppMenuChoice()
        if choice == "0":
            continue
        if choice == "1":
            LikesToGlit(server_sock, account_data)
        elif choice == "2":
            LikesToGlitDifferentUsername(server_sock, account_data)
        elif choice == "3":
            postGlitDifferentColor(server_sock, account_data)
        elif choice == "4":
            postGlitDifferentAvatar(server_sock, account_data)
        elif choice == "5":
            postGlitDifferentDate(server_sock, account_data)
        elif choice == "6":
            postGlitDifferentFontColor(server_sock, account_data)
        elif choice == "7":
            removeOtherUserLike(server_sock, account_data)
        elif choice == "8":
            postCommentDifferentDate(server_sock, account_data)
        elif choice == "9":
            postCommentDifferentUsername(server_sock, account_data)
        else:
            print("Invalid choice, try again")


def main():
    choice = "-1"
    while choice != "0":
        choice = getChoice()
        if choice == "1":
            penTestwebsite()
        if choice == "2":
            penTestapp()


if __name__ == '__main__':
    main()
